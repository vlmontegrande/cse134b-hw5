<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Contact</title>
        <link rel="stylesheet" href="assets/css/contact.css">
    </head>
    <body>
        <header>
            <nav>
                <a href="index.html" id="main-link">Vince Montegrande</a>
                <ul>
                    <li><a href="projects.html">Projects</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <svg width="24" height="24" viewBox="0 0 24 24" id="theme-toggle">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M17 3.34a10 10 0 1 1 -15 8.66l.005 -.324a10 10 0 0 1 14.995 -8.336m-9 1.732a8 8 0 0 0 4.001 14.928l-.001 -16a8 8 0 0 0 -4 1.072" />
                    </svg>
                </ul>
                <svg viewBox="0 0 100 80" width="40" height="40" id="hamburger-menu">
                    <rect width="100" height="20" rx="8"></rect>
                    <rect y="30" width="100" height="20" rx="8"></rect>
                    <rect y="60" width="100" height="20" rx="8"></rect>
                </svg>
            </nav>
        </header>

        <hr>

        <main>
            <form method="GET" action="https://httpbin.org/get">
                <fieldset>
                        <legend>Contact</legend>
                
                        <label for="name">Name*:</label>
                        <input type="text" id="name" name="name" pattern="[a-zA-Z\s]+" required>
                
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email">

                        <label for="message">Message*:</label>
                        <textarea id="message" name="message" rows="4" maxlength="280" required></textarea>

                        <input id="possible_bot" name="possible_bot" value="true" hidden>

                        <noscript>Name must only use letters and spaces, Email must be valid, and Message must be less than 280 characters</noscript>

                        <output id="info-output"></output>
                        <output id="error-output"></output>
                    
                        <button type="submit">Submit</button>
                </fieldset>
              </form>
              <address>
                <div id="address-container">
                    <h1>Social and Professional Links</h1>
                    <p>Email: <a target="_blank" href="mailto:vlmontegrande@gmail.com">vlmontegrande@gmail.com</a></p>
                    <p>Github: <a target="_blank" href="https://github.com/vlmontegrande">vlmontegrande</a></p>
                    <p>Instagram: <a target="_blank" href="https://www.instagram.com/vince_montegrande/">vince_montegrande</a></p>
                    <p>Resume: <a target="_blank" href="assets/misc/resume.pdf">pdf</a></p>
                </div>
            </address>
        </main>

        <hr>

        <footer>
            <a href="https://github.com/vlmontegrande/cse134b-hw2.git">Website Github</a>
            <p><small>&copy; 2025 Vince Montegrande</small></p>
        </footer>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const themeToggle = document.querySelector('#theme-toggle');
                themeToggle.style.display = 'block';
                
                const savedTheme = localStorage.getItem('theme');
                const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                if (savedTheme === 'dark' || (savedTheme === null && prefersDarkScheme)) {
                    document.documentElement.classList.add('dark-theme');
                }
                
                const toggleTheme = () => {
                    const isDarkTheme = document.documentElement.classList.toggle('dark-theme');
                    
                    themeToggle.innerHTML = isDarkTheme ? sunIcon : moonIcon;
                    
                    localStorage.setItem('theme', isDarkTheme ? 'dark' : 'light');
                };
                
                themeToggle.addEventListener('click', toggleTheme);
            });

            let form_errors = [];

            const form = document.querySelector('form');
            const nameInput = document.getElementById('name');
            const emailInput = document.getElementById('email');
            const messageTextarea = document.getElementById('message');
            const errorOutput = document.getElementById('error-output');
            const infoOutput = document.getElementById('info-output');

            function showErrorMessage(message) {
                errorOutput.textContent = message;
                errorOutput.style.opacity = '1';
                
                setTimeout(() => {
                    let opacity = 1;
                    const fadeInterval = setInterval(() => {
                        opacity -= 0.1;
                        errorOutput.style.opacity = opacity;
                        if (opacity <= 0) {
                            clearInterval(fadeInterval);
                            errorOutput.textContent = '';
                            errorOutput.style.opacity = '1';
                        }
                    }, 100);
                }, 3000);
            }

            function logError(fieldName, errorType) {
                form_errors.push({
                    field: fieldName,
                    errorType: errorType
                });
            }

            // Message validation and error

            const maxChars = 280;

            function updateCharCount() {
                const remainingChars = maxChars - messageTextarea.value.length;
                infoOutput.textContent = `${remainingChars} characters remaining`;
                
                if (remainingChars <= 10) {
                    infoOutput.style.color = 'red';
                } else if (remainingChars <= 50) {
                    infoOutput.style.color = 'orange';
                } else {
                    infoOutput.style.color = 'var(--primary-color)';
                }
                
                if (remainingChars < 0) {
                    showErrorMessage('Message exceeds the maximum length');
                    logError('message', 'exceeded_max_length');
                }
            }

            updateCharCount();
            messageTextarea.addEventListener('input', updateCharCount);

            // Validation errors

            nameInput.addEventListener('blur', () => {
                if (!nameInput.checkValidity()) {
                    showErrorMessage('Name is required and must contain only letters and spaces.');
                    logError('name', 'invalid_format');
                }
            });

            emailInput.addEventListener('blur', () => {
                if (emailInput.value && !emailInput.checkValidity()) {
                    showErrorMessage('Please enter a valid email address.');
                    logError('email', 'invalid_format');
                }
            });

            messageTextarea.addEventListener('blur', () => {
                if (!messageTextarea.checkValidity()) {
                    showErrorMessage('Message is required.');
                    logError('message', 'empty_field');
                }
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();

                let name = nameInput.value;
                let email = emailInput.value;
                let message = messageTextarea.value;
                let errors = JSON.stringify(form_errors);

                let xhr = new XMLHttpRequest();
                let url = `https://httpbin.org/get?name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&message=${encodeURIComponent(message)}&form-errors=${encodeURIComponent(errors)}`;
                xhr.open('GET', url, true);
                xhr.setRequestHeader('X-Sent-By', 'JavaScript');
                xhr.send(null);

                form.reset();
                updateCharCount();
            });
        </script>
    </body>
</html>